<html><body><h1>Documentation Plugin Zibase pour SARAH</h1><br>auteur : Baptiste MARIENVAL<br>date : 07/07/2013<br>version : 3.0<br> <br> <br>1. CONFIGURATION ZIBASE.PROP<br>2. DESCRIPTEUR DE PERIPHERIQUES (periph.xml)<br>3. LE FICHIER ZIBASE.XML<br>4. CHANGELOG<br> <br> <br> <br><b>1.   CONFIGURATION ZIBASE.PROP</b><br> <br>Le fichier zibase.prop permet de paramétrer les informations nécessaires au bon fonctionnement du plugin.<br>Il est donc indispensable de renseigner ces 5 éléments :<br><li>plateforme_web</li>Correspond à l'adresse de la plateforme zibase de votre installation. Par exemple, si vous utilisez la plateforme zibase-club, la valeur sera zibase-club.net. Par défaut, la valeur est zibase.net.<br><li>ip_lan</li>Permet d'envoyer des requêtes directement à la Zibase via le réseau local (sans passer par la plateforme web). Il suffit pour cela d'indiquer l'adresse IP locale de la Zibase, par exemple : 192.168.0.2<br><li>acces_method</li>Valeurs possibles : « lan » | « web »<br>Ce paramètre permet de choisir entre la méthode locale (lan) ou via la plateforme web (web).<br> Il est conseillé d'utiliser le mode lan pour des questions de temps de réponse, de sécurité et de disponibilité. De plus, certaines fonctionnalités du plugin ne sont disponible que pour le mode lan.<br><li>device</li>Indique le nom de votre Zibase (ZIBASEXXXXX).<br><li>token</li>Le token associé a votre compte, visible dans l'onglet systeme de l'interface web.<br> <br>Ces informations sont disponibles dans la partie « Système » de l’interface Zibase<br><img border=0 width=352 height=142 src="./assets/zibase/images/aide_identification.jpg"> <br><br> <br>Les paramètres « device » et « token » sont utilisés uniquement dans le cas d'une connexion web. Lors de l'appel local (mode lan), ils ne sont pas utilisés.<br>Le mode lan permet une meilleure réactivité et un fonctionnement "offline" (en cas de coupure d'internet par exemple).<br>Le mode web oblige la requête à transiter via un serveur externe.<br>Il est conseillé d'utiliser le mode lan pour des raisons de performance et de sécurité.<br> <br> <br><b>2.   DESCRIPTEUR DE PERIPHERIQUES (periph.xml)</b><br> <br>Depuis la version 2.3, la configuration des périphériques passe par un fichier externe : periph.xml.<br>Celui ci permet de déclarer ses modules, sondes et scénarios afin de les utiliser ensuite de façon simple dans le reste du plugin, sans avoir à manipuler le code javascript.<br>Voici un exemple de configuration :<br> <br> <i>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>&lt;peripheriques&gt;<br>&lt;!-- SONDES --&gt;<br>&lt;periph nom="sonde_temp_ext" type="sonde" proto="OS" addr="439219202" addr2="v1" operation="/10" tts="La température extérieure est de %s degrés"/&gt;<br>&lt;periph nom="sonde_hygro_ext" type="sonde" proto="OS" addr="439219202" addr2="v2" operation="" tts="L'hygrométrie extérieure est de %s pourcent"/&gt;<br>&lt;periph nom="sonde_battery_ext" type="sonde" proto="OS" addr="439219202" addr2="lowbatt" operation="" tts="Le niveau des piles est %s"/&gt;<br>&lt;periph nom="sonde_conso_elec" type="sonde" proto="WS" addr="133954" addr2="v2" operation="*100" tts="La consommation ailaiquetrique globale est de %s kilo watt heure"/&gt;<br>&lt;periph nom="sonde_battery_elec" type="sonde" proto="WS" addr="133954" addr2="lowbatt" operation="" tts="Le niveau des piles est %s"/&gt;<br>&lt;!-- ZWAVE --&gt;<br>&lt;periph nom="volet_sam" type="module" proto="6" addr="A" addr2="3" tts=" les volets de la salle à manger "/&gt;<br>&lt;!-- CHACON --&gt;<br>&lt;periph nom="lumiere_bureau" type="module" proto="0" addr="B" addr2="1" tts=" la lumière du bureau "/&gt;<br>&lt;periph nom="prise_tv" type="module" proto="0" addr="G" addr2="1" tts=" la prise de la télévision "/&gt;<br>&lt;!-- BLYSS --&gt;<br>&lt;periph nom="vmc" type="module" proto="10" addr="G" addr2="1" tts=" la VMC "/&gt;<br>&lt;!-- SCENARIO --&gt;<br>&lt;periph nom="alarme_OFF" type="scenario" proto="" addr="9" addr2="" tts=" Alarme désactivée "/&gt;<br>&lt;periph nom="alarme_ON" type="scenario" proto="" addr="10" addr2="" tts=" Alarme activée "/&gt;<br>&lt;/peripheriques&gt;<br></i> <br>L’attribut <b>« nom »</b> de la balise <periph> correspond à l’identifiant. Il doit donc être unique. C’est a partir de ce nom que l’on pourra récupérer le reste des attributs.<br>Il est donc conseillé de suivre une norme de nommage rigoureuse du type : type_info_piece_numero par exemple.<br> <br>L’attribut <b>« type »</b> correspond,  comme son nom l’indique, au type de périphérique. 3 valeurs sont possibles : ‘module’, ‘sonde’ et ‘scenario’. Cette information sera utilisée dans la code javascript pour construire l’URL appelée afin de récupérer les bonnes informations.<br> <br>L’attribut <b>« proto »</b> indique le protocole utilisé. Pour les sondes, on retrouve cette information sur l’interface de configuration Zibase, dans la partie « périphériques ». Ce sont les 2 lettres correspondant à l’adresse de la sonde. Sur l’image ci dessous, le protocole vaut ‘OS’.<br><img border=0 width=533 height=117 src="./assets/zibase/images/aide_sonde.jpg"><br><br>Pour connaitre le protocole utilisé pour les modules, se référer au tableau ci dessous :<br><table>	<tr>		<td>PROTOCOLE</td>		<td>ID</td>	</tr>	<tr>		<td>DEFAULT BROADCAST (X10, CHACON)</td>		<td>0</td>	</tr>	<tr>		<td>VISONIC433 ( frequency : device RF LOW, 310..418..433Mhz band))</td>		<td>1</td>	</tr>	<tr>		<td>VISONIC868</td>		<td>2</td>	</tr>	<tr>		<td>CHACON (32bits frame) (ChaconV2/DIO series)</td>		<td>3</td>	</tr>	<tr>		<td>DOMIA (24 bits frame) ( Chacon V1 + low-cost devices)</td>		<td>4</td>	</tr>	<tr>		<td>RF X10</td>		<td>5</td>	</tr>	<tr>		<td>ZWAVE</td>		<td>6</td>	</tr>	<tr>		<td>RFS10/TS10</td>		<td>7</td>	</tr>		<tr>		<td>XDD433 alrm</td>		<td>8</td>	</tr>		<tr>		<td>XDD868 alrm</td>		<td>9</td>	</tr>		<tr>		<td>XDD868 inter/shutter</td>		<td>10</td>	</tr>		<tr>		<td>XDD868 Pilot Wire</td>		<td>11</td>	</tr>		<tr>		<td>XDD868 Boiler/AC</td>		<td>12</td>	</tr>	</table> <br> <br>L’attribut <b>« addr »</b> permet d’identifier le module/sonde/scénario mais sa valeur diffère suivant les cas. Dans le cas d’une sonde, cette adresse correspond à la suite de chiffre du champ identifiant radio (dans l’exemple précédent, le champ addr vaut 439219202). Dans le cas d’un scénario, cet attribut correspond à l’identifiant du scénario dans le système Zibase. Pour retrouver ce numéro, il suffit dans lancer le scénario. Le numéro apparaitra entre parenthèses dans le suivi d’activité. Enfin, pour un module, l’attribut addr doit etre renseigné avec la lettre correspondante (voir image ci dessous).<br> <br><img border=0 width=501 height=117 src="./assets/zibase/images/aide_module.jpg"> <br>Ici, le champ <b>« addr »</b> doit être renseigné avec la valeur ‘A’ (ne pas mettre le ‘Z’ pour les modules Zwave).<br> <br>L’attribut <b>« addr2 »</b> permet de compléter l’adresse dans le cas des modules (dans l’exemple précédent, addr2 vaudra ‘3’). Pour les sondes, cet attribut permet de choisir l’information souhaitée. Pour cela, référez vous à la notice de votre sonde (par exemple, pour les sondes Oregon Scientific THGR228N, la température se trouvera dans le champ v1 de la réponse et l’hygrométrie dans le champ v2). La 3ème valeur possible, dans le cas des sondes, est ‘lowbatt’ qui permet d’avoir un retour d’état du niveau des piles de la sonde. Enfin, pour les scénarios, cet attribut est optionnel.<br>Pour résumer, pour les sondes, 3 valeurs possibles : v1, v2 et lowbatt. Pour les modules, il faut renseigner les chiffres de l ‘identifiant radio, et pour les scénarios, il faut le laisser vide.<br> <br>L’attribut <b>« operation »</b> est utilisé uniquement dans le cas des sondes. Suivant les sondes, il est parfois souhaitable de convertir la valeur renvoyée par la sonde. Par exemple, les sondes Oregon Scientific retourne 200 pour une température de 20°. L’attribut « operation » permet donc de diviser cette valeur par 10 afin de convertir cette valeur en degrés (operation="/10").<br> <br>L’attribut <b>« tts »</b> permet de définir la phrase de retour voulu et qui sera énoncé par Sarah. Dans le cas des sondes, la chaine %s sera remplacer par la valeur de la sonde après l’éventuel calcul de conversion. Par exemple, si l’attribut vaut tts="La température extérieure est de %s degrés" et que la sonde retourne 237, si " operation="/10" alors Sarah dira « La température extérieure est de 23 virgule 7 degrés ».<br> <br> <br><b>3.   LE FICHIER ZIBASE.XML</b><br> <br>C'est dans ce fichier que nous allons définir notre grammaire et les actions à effectuer. L’utilisation du fichier periph.xml permet de simplifier au  maximum l’écriture de ce fichier. Au final, uniquement 5 paramètres nous intéressent :<br> <br><li>actionModule</li>	Action à effectuer (valeur possible : ON, OFF). Uniquement dans le cas d'une action sur un périphérique.<br><li>ttsAction</li>      Retour vocal de l’action (par exemple out.action.ttsAction="j'allume" dans le cas d’une action ON).<br><li>module</li>         C’est dans ce paramètre que nous allons déclarer le nom du module référencé dans le fichier periph.xml (qui doit être unique pour rappel).<br><li>dimValue</li>       Valeur du variateur en pourcentage si nécessaire<br><li>ttsDim</li>         Retour vocal pour la valeur du variateur<br> <br>Se référer au fichier exemple fournis pour une meilleure compréhension.<br> <br><b>4.   CHANGELOG</b><br><br><b>version 2.0 (31/05/2013)</b><br>Mise à jour du plugin de Garth<br>Zibase API 1.4<br>Gestion de scénario<br>Mode online/offline<br> <br><b>version 2.1 (18/06/2013)</b><br>Suppression attribut actionType<br>Correction faute de frappe alphabet<br> <br><b>version 2.2 (23/06/2013)</b><br>Retour des actions par tts.<br>Gestion variateurs DIM (chacon & zwave)<br>Renommage des attributs<br> <br><b>version 3.0 (07/07/2013)</b><br>Gestion des sondes (offline)<br>Descripteur XML de périphériques<br><br></body></html>